# 02_Git内部構造入門 🧠🐈

Gitのコマンドは覚えたけど、`detached HEAD` とか言われるとパニックになる人へ。
Gitが裏で何をしているか（データ構造）を知れば、どんなエラーも怖くありません。

## 1. .git ディレクトリの中身
Gitの正体は、単なる **KVS (Key-Value Store)** です。
`.git/objects` の中に、全てのファイルの中身やコミット情報が、**ハッシュ値**（SHA-1）をキーとして保存されています。

## 2. 3つのオブジェクト
Gitの世界には3種類の登場人物しかいません。

1. **Blob (Binary Large Object)**: ファイルの中身そのもの。「ファイル名」は含みません。
2. **Tree**: ディレクトリ。「ファイル名」と「Blobへのポインタ」のリスト。
3. **Commit**: 「ある時点のTreeへのポインタ」＋「親コミットへのポインタ」＋「メッセージ・作者」。

## 3. ブランチの正体
ブランチとは、**ただの付箋（ポインタ）** です。
例えば `main` ブランチは、「最新のコミットID (`a1b2c3d`)」と書かれたメモ紙にすぎません。

- **コミットする**: 新しいCommitオブジェクトができ、付箋(`main`)を新しいIDに貼り替える。
- **ブランチを作る**: 現在のIDと同じIDを書いた新しい付箋(`feature`)を作るだけ。一瞬で終わる。
- **HEAD**: 「今、自分がどの付箋の上にいるか」を示す、特別な付箋。

## 4. Detached HEAD とは？
通常、HEADは「ブランチ（付箋）」の上に乗っています (`HEAD -> main`)。
しかし、`git checkout <過去のコミットID>` などをすると、HEADはブランチから離れて、コミットの上に直接乗ってしまいます。
これが「頭（HEAD）が分離（Detached）した」状態です。
この状態でコミットしても、どのブランチ（付箋）も進まないので、別のブランチに移動するとそのコミットは迷子になります（Garbage Collectionで消えます）。

**直し方**: その場に新しいブランチ（付箋）を作ってあげれば解決です。
`git checkout -b new-branch-name`

---

## 📚 用語集 (Glossary)

| 用語 | 意味 | イメージ |
|------|------|-----|
| **Blob** | ファイルの実体 | ドロドロした塊 |
| **Tree** | ディレクトリ情報 | ファイル名と場所のリスト |
| **Commit Object** | コミット情報 | 誰がいつ何をしたか＋親は誰か |
| **SHA-1** | ハッシュ値 | `a1b2c3d...` みたいなID。指紋。 |
| **Pointer** | ポインタ | 「あっち」を指す矢印 |
| **Detached HEAD** | 分離したヘッド | 幽体離脱。ブランチから外れた状態。 |
| **Garbage Collection (GC)** | ゴミ掃除 | 誰からも参照されないデータを消す機能 |

