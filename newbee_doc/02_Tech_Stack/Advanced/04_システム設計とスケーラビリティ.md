# 04_システム設計とスケーラビリティ 🏗️

ユーザーが100人の時と100万人の時では、システムの作り方が全く違います。
大規模システムを支える設計の概念を学びます。

## 1. スケールアップ vs スケールアウト

### スケールアップ (垂直分散)
- **「サーバーを強くする」**
- CPUを速くする、メモリを増やす。
- 簡単だけど限界がある。1台のスーパーコンピュータを作るのはコストが高い。

### スケールアウト (水平分散)
- **「サーバーを増やす」**
- 普通の性能のサーバーを10台、100台と並べる。
- クラウド時代はこちらが主流。無限に性能を伸ばせるが、アプリケーションの設計が難しくなる（Statelessである必要がある）。

## 2. ロードバランサ (Load Balancer)
アクセスの交通整理係です。
大量に来たリクエストを、後ろにいる複数のサーバーに均等に振り分けます。
ユーザーからは1つのサーバーに見えますが、裏では100台が働いていたりします。

## 3. CAP定理
分散システムの「あるあるトレードオフ」です。
**3つのうち2つしか同時に満たせない** という法則です。

1. **C (Consistency - 一貫性)**:
   - 誰がいつ読んでも必ず最新の正しいデータが返る。
2. **A (Availability - 可用性)**:
   - サーバーの一部が壊れても、システム全体は止まらず応答する。
3. **P (Partition Tolerance - 分断耐性)**:
   - 通信障害でネットワークが分断されても動き続ける。

RDB（Supabase/Postgres）は基本的に **CA** または **CP** 型です。
NoSQL（DynamoDBなど）は一貫性(C)を犠牲にして、可用性(A)と分断耐性(P)を取ることが多いです（Eventual Consistency = そのうち整合性が合う）。

## 4. キャッシュ戦略 (Caching)
「重い処理はサボる」のが高速化の基本です。

- **CDN (Content Delivery Network)**: 画像や動画を、ユーザーの近くのサーバーにコピーして置く。日本からのアクセスには東京のサーバーが応答する。
- **In-Memory Cache (Redis)**: DBへのクエリ結果をメモリに保存しておく。
  - 「人気ランキング」のように、**誰が見ても同じで、頻繁に参照されるデータ** はキャッシュに最適。
  - 逆に「ユーザーごとの通知」はキャッシュしにくい。

## 5. 単一障害点 (SPOF - Single Point of Failure)
「ここが壊れたら全部止まる」という弱点のこと。
システム設計では、SPOFをいかになくすか（冗長化）が勝負です。
DBが1系統しかない、ロードバランサが1台しかない、開発用PCで本番キーを管理している（人的SPOF）など。

---

## 📚 用語集 (Glossary)

| 用語 | 意味 | 例 |
|------|------|-----|
| **Scalability (拡張性)** | 負荷が増えても耐えられる能力 | - |
| **Scale Up** | 個体の強化 | 筋肉増強 |
| **Scale Out** | 数の暴力 | 分身の術 |
| **Load Balancer** | 負荷分散装置 | 交通整理 |
| **SPOF** | 単一障害点 | ウィークポイント |
| **CDN** | コンテンツ配信ネットワーク | Muxもこれを使っている |
| **Latency (レイテンシ)** | 応答速度 | 近いほうが速い |
| **Thoughtput (スループット)** | 処理能力 | 単位時間あたりの処理量 |

