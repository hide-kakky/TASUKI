# 10. 動画処理とMux

## 🎯 このレッスンで学ぶこと

- 動画データの難しさ
- Mux（マックス）の役割
- ストリーミング配信（HLS）
- アップロードの流れ

---

## 1. 動画データは「重くて複雑」

### サイズの問題
- テキスト: 数KB
- 画像: 数MB
- 動画: **数百MB〜数GB**

### 形式の問題
- iPhoneで撮った動画（.mov）
- Androidで撮った動画（.mp4）
- PCで見れる形式、スマホで見れる形式...

これらを自前サーバーで扱うのは大変です！
- サーバーの容量がすぐパンクする
- 変換処理でサーバーが重くなる
- 再生がカクカクする

---

## 2. Mux（マックス）とは？

**動画のためのバックエンドサービス** です。

「動画ファイルを渡せば、あとは全部やってくれる」すごいサービス。

### Muxがやってくれること
1. **エンコーディング**: 最適な形式に変換
2. **ストレージ**: 動画を保存
3. **配信（CDN）**: 世界中どこからでも高速に再生
4. **サムネイル生成**: 自動で画像を作る

---

## 3. HLS（HTTP Live Streaming）

TASUKIでは **HLS** という方式で動画を再生します。

### ダウンロード再生 vs ストリーミング再生

**ダウンロード再生 (.mp4)**
- ファイルを全部（またはある程度）ダウンロードしてから再生
- ❌ 待ち時間が長い
- ❌ 通信量を食う

**ストリーミング再生 (HLS)**
- 動画を10秒ごとの小さなファイルに分割
- 必要な分だけ少しずつダウンロードして再生
- ✅ すぐ再生開始
- ✅ 回線速度に合わせて画質を自動調整（YouTubeと同じ！）

Muxは、アップロードされた動画を自動でこのHLS形式に変換してくれます。

---

## 4. TASUKIでの動画フロー

```
1. 【Flutter】スマホで撮影
   ↓
2. 【Flutter】Muxに直接アップロード
   （Supabaseサーバーを経由しないので高速！）
   ↓
3. 【Mux】動画処理開始（Webhookで通知）
   ↓
4. 【Supabase】Webhookを受け取り、DBに「処理中」と記録
   ↓
5. 【Mux】処理完了（HLS URL発行）
   ↓
6. 【Supabase】URLを保存 → AI処理開始
```

---

## 📝 まとめ

- 動画は扱うのが難しい（重い・複雑）
- Muxに任せることで解決
- HLS形式でスムーズなストリーミング再生
- アップロードはスマホから直接Muxへ

---

次は「11_コードの読み方.md」で、実際のTASUKIのコードを見てみましょう！
