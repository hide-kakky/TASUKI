# 12_OSとプロセス・スレッド 🖥️

「アプリが重い」「メモリリークした」
これらの問題を本当に理解するには、OS（オペレーティングシステム）がどうやってプログラムを動かしているかを知る必要があります。

## 1. プロセス (Process) とは？
OSから見た「実行中のプログラムの単位」です。
アプリを起動すると、OSは以下のものをセットで用意します。
- **メモリ空間**: そのアプリだけが使えるメモリの領域。
- **ファイル記述子 (File Descriptor)**: 開いているファイルやソケットのリスト。

プロセス同士は基本的に**メモリを共有しません**。だから、あるアプリがクラッシュしても、他のアプリ（やOS自体）は巻き込まれずに済みます。

## 2. スレッド (Thread) とは？
プロセスの中で動く「処理の実行単位」です。
1つのプロセスの中に、複数のスレッドを作ることができます（マルチスレッド）。

- **メモリ共有**: 同じプロセス内のスレッドは、メモリ（変数など）を共有します。
- **並行処理**: 「画面を描画するスレッド(UI Thread)」と「通信するスレッド(IO Thread)」を分けることで、サクサク動くアプリが作れます。

### Flutter (Dart) の特殊性: Isolate
Dart は基本的に **シングルスレッド** です。
「え？非同期処理できるじゃん？」と思いますが、あれは「イベントループ」という仕組みで、1つのスレッドの中でうまく待ち時間を活用しているだけです。

本当に重い計算（画像処理など）をすると、シングルスレッドなのでUIが止まります。
そこで Dart では **Isolate (アイソレート)** を使います。
これはスレッドに似ていますが、**メモリを共有しません**（これが重要！）。
メモリを共有しないので、「変数を同時に書き換えてバグる（競合状態）」というマルチスレッド特有の悪夢が起きません。

## 3. メモリ管理 (Stack vs Heap)

### Stack (スタック)
- 関数の呼び出し履歴や、ローカル変数が置かれる場所。
- 「積み上げ」て「取り出す」。関数が終わると自動で消える。
- 高速だが容量は小さい。再帰呼び出ししすぎると `Stack Overflow` します。

### Heap (ヒープ)
- `new` (Dartではコンストラクタ) で作ったオブジェクトが置かれる場所。
- 広いけど管理が大変。
- **Garbage Collection (GC)**: 使われなくなったオブジェクトを自動でお掃除する仕組み。Dartにも備わっています。

## 4. ファイルシステムと権限
UNIX系OS（Mac, Linux, Android, iOSのベース）では、全てがファイルとして扱われます。

### Permission (権限)
`rwx` (Read, Write, Execute) の3つで管理されます。
- アプリがカメラを使おうとするとエラーになるのは、OSレベルでファイル（デバイス）へのアクセス権限がないからです。 `AndroidManifest.xml` や `Info.plist` は、OSに「この権限をください！」と申請するための手紙です。

---

## 📚 用語集 (Glossary)

| 用語 | 意味 | Dart/Flutterでの例 |
|------|------|-----|
| **OS** | オペレーティングシステム | iOS, Android, macOS |
| **Kernel (カーネル)** | OSの核。ハードウェアを制御する | - |
| **Process (プロセス)** | 実行中のアプリ | TASUKIアプリ全体 |
| **Thread (スレッド)** | プロセス内の仕事人 | UIスレッド |
| **Isolate (アイソレート)** | Dart版のスレッド（メモリ非共有） | `compute()`関数で使う |
| **Stack (スタック)** | 一時メモリ領域 | 関数内の変数 `int a = 1;` |
| **Heap (ヒープ)** | 巨大メモリ領域 | `class` のインスタンス |
| **GC** | ガベージコレクション（メモリ掃除） | 自動で行われる |

## 🛠️ コマンド集 (Unix Commands)

| コマンド | 説明 |
|---|---|
| `ps` | 現在動いているプロセスを見る |
| `top` | プロセスのリソース使用状況をリアルタイムで見る |
| `kill <pid>` | プロセスを強制終了する |
| `chmod` | ファイルの権限を変更する（Change Mode） |
