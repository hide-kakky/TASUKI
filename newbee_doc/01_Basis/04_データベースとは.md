# 04. データベースとは何か？

## 🎯 このレッスンで学ぶこと

- データベースの役割
- データベースの種類
- TASUKIで使うPostgreSQL
- テーブル・カラム・行の概念
- SQLの基礎

---

## 1. データベースとは「デジタル倉庫」

### 現実世界の倉庫

```
図書館
├── 棚A（小説）
│   ├── 本1: タイトル、著者、ISBN
│   ├── 本2: タイトル、著者、ISBN
│   └── ...
├── 棚B（雑誌）
└── 棚C（参考書）
```

### データベース = デジタル倉庫

```
データベース
├── テーブルA（ユーザー）
│   ├── ユーザー1: ID, 名前, メール
│   ├── ユーザー2: ID, 名前, メール
│   └── ...
├── テーブルB（マニュアル）
└── テーブルC（動画）
```

**データベース** = 大量のデータを整理して保存し、素早く検索できるようにする仕組み

---

## 2. なぜデータベースが必要か？

### Excelとの違い

| | Excel | データベース |
|---|-------|------------|
| **データ量** | 数千行まで | 数百万行でもOK |
| **同時アクセス** | 1人ずつ | 何千人でもOK |
| **検索速度** | 遅くなる | 常に高速 |
| **データの整合性** | 手動管理 | 自動チェック |

**TASUKIの例**:
- 全国100店舗、各店舗1000件のマニュアル = 10万件のデータ
- 数千人のスタッフが同時にアクセス
- → Excelでは無理！データベースが必須

---

## 3. データベースの基本構造

### テーブル（表）

データは「テーブル」という表形式で保存されます。

**例: users（ユーザー）テーブル**

| id | display_name | language | created_at |
|----|--------------|----------|------------|
| 1 | 山田太郎 | ja | 2025-11-01 |
| 2 | グエン | vi | 2025-11-15 |
| 3 | 佐藤花子 | ja | 2025-12-01 |

### 用語の理解

- **テーブル** = 表全体（usersテーブル）
- **カラム（列）** = 縦の項目（id, display_name, language...）
- **行（レコード）** = 横の1件分のデータ（山田太郎さんの情報）

### プライマリーキー（主キー）

**id** = プライマリーキー（PK）

- 各行を一意に識別するための番号
- 絶対に重複しない
- 削除されない

**なぜ必要？**:
「山田太郎」という名前の人が2人いたら区別できない
→ idで区別する（id=1とid=5は別人）

---

## 4. リレーション（関連）

複数のテーブルを**関連付ける**ことができます。

### TASUKIの例

```
usersテーブル              manualsテーブル
┌────┬──────┐            ┌────┬──────────┬─────────┐
│ id │ name │            │ id │  title   │ user_id │
├────┼──────┤            ├────┼──────────┼─────────┤
│ 1  │ 太郎 │ ────┐     │ 10 │ オーダー │    1    │
│ 2  │ 花子 │     └───> │ 11 │ レジ締め │    1    │
└────┴──────┘            │ 12 │ 清掃     │    2    │
                          └────┴──────────┴─────────┘
```

**user_id = 外部キー（FK）**
- 他のテーブルのidを参照する
- 「このマニュアルは誰が作ったか？」がわかる

---

## 5. SQL（データベース言語）

### SQLとは？

**S**tructured **Q**uery **L**anguage = 構造化問い合わせ言語

データベースに命令を出すための言語です。

### 基本的なSQL文

#### 1. SELECT（検索）

```sql
-- ユーザー全員を表示
SELECT * FROM users;

-- 日本語ユーザーのみ表示
SELECT * FROM users WHERE language = 'ja';

-- 名前と言語だけ表示
SELECT display_name, language FROM users;
```

#### 2. INSERT（追加）

```sql
-- 新しいユーザーを追加
INSERT INTO users (display_name, language)
VALUES ('田中次郎', 'ja');
```

#### 3. UPDATE（更新）

```sql
-- id=1のユーザーの名前を変更
UPDATE users
SET display_name = '山田一郎'
WHERE id = 1;
```

#### 4. DELETE（削除）

```sql
-- id=3のユーザーを削除
DELETE FROM users WHERE id = 3;
```

---

## 6. TASUKIで使うPostgreSQL

### PostgreSQLとは？

**世界で最も先進的なオープンソースデータベース**

**特徴**:
- 無料
- 高機能
- 信頼性が高い
- JSONデータも扱える

### なぜPostgreSQLを選んだ？

1. **RLS（Row Level Security）が強力**
   - 行レベルでアクセス制御ができる
   - 「Staffは自分の店舗のデータだけ見られる」を自動で制御

2. **Supabaseの標準データベース**
   - Supabaseと相性抜群

3. **JSONBサポート**
   - `ai_steps`（手順リスト）をJSON形式で保存できる

---

## 7. TASUKIのテーブル構成（簡略版）

```
organizations（組織）
  ├ id
  ├ name（組織名）
  └ plan（プラン）

stores（店舗）
  ├ id
  ├ organization_id（所属組織）
  └ name（店舗名）

users（ユーザー）
  ├ id
  ├ display_name（表示名）
  └ language（言語）

memberships（所属・権限）
  ├ user_id（ユーザー）
  ├ store_id（店舗）
  └ role（権限: owner/manager/staff）

manuals（マニュアル）
  ├ id
  ├ store_id（店舗）
  ├ status（draft/published）
  ├ ai_summary（要約）
  └ ai_steps（手順）
```

**リレーションの例**:
```
user(id=1) → memberships(user_id=1, store_id=5, role=manager)
            → store(id=5, name=銀座本店)
```
→ 「id=1のユーザーは、銀座本店のmanager」

---

## 8. 重要な専門用語

| 用語 | 意味 | 例 |
|------|------|-----|
| **データベース（DB）** | データを保存・管理する仕組み | PostgreSQL |
| **テーブル** | データの表 | usersテーブル |
| **カラム（列）** | 項目 | display_name, language |
| **行（レコード）** | 1件分のデータ | 山田太郎さんの情報 |
| **プライマリーキー（PK）** | 一意識別子 | id |
| **外部キー（FK）** | 他テーブルへの参照 | user_id |
| **SQL** | データベース操作言語 | SELECT, INSERT |

---

## 9. ミニクイズ 🎯

### Q1: プライマリーキー（id）はなぜ必要ですか？
<details>
<summary>答えを見る</summary>

**答え**: 各行を一意に識別するため。同姓同名の人がいても、idで区別できる。

</details>

### Q2: 外部キーとは何ですか？
<details>
<parameter name="summary">答えを見る</summary>

**答え**: 他のテーブルのプライマリーキーを参照するカラム。テーブル間の関連を作る。

例: manuals.user_id → users.id

</details>

### Q3: TASUKIがPostgreSQLを選んだ理由は？
<details>
<summary>答えを見る</summary>

**答え**:
1. RLS（行レベルセキュリティ）が強力
2. Supabaseの標準DB
3. JSONBで柔軟なデータ保存が可能

</details>

---

## 📝 まとめ

- ✅ データベース = 大量データを整理・保存する仕組み
- ✅ テーブル・カラム・行の構造
- ✅ SQL = データベース操作言語
- ✅ TASUKIはPostgreSQLを使用
- ✅ リレーションで複数テーブルを関連付け

---

## 🚀 次のステップ

次は「05_フロントエンドとバックエンド.md」でアプリの構成要素を学びます！

---

## 💡 ブログに書くなら

```markdown
# データベースについて学んだ

## データベース = デジタル倉庫
大量のデータを整理して素早く検索できる仕組み。

## 覚えた用語
- テーブル（表）, カラム（列）, 行（レコード）
- プライマリーキー（一意識別子）
- 外部キー（他テーブルへの参照）
- SQL（データベース操作言語）

## TASUKIではPostgreSQL
RLS（行レベルセキュリティ）で「Staffは自分の店舗のみ」を自動制御できる！
```
