# 05. フロントエンドとバックエンド

## 🎯 このレッスンで学ぶこと

- フロントエンドとバックエンドの違い
- それぞれの役割
- TASUKIでの実装
- クライアント・サーバーモデル

---

## 1. レストランに例えると

### フロントエンド = ホール（お客様が見える部分）

```
お客様
  ↓
ホールスタッフ
  - メニューを渡す
  - オーダーを聞く
  - 料理を運ぶ
```

### バックエンド = キッチン（裏側の処理）

```
キッチン
  - 料理を作る
  - 食材を管理する
  - 在庫を確認する
```

**お客様はキッチンを直接見ません**が、キッチンがなければ料理は出せません！

---

## 2. Webアプリケーションの世界

### フロントエンド（Front-end）

**ユーザーが直接触る部分**

```
スマホアプリ
├── 画面
├── ボタン
├── 入力フォーム
└── 表示されるデータ
```

**TASUKIの例**:
- 録画ボタン
- タイムライン
- マニュアル詳細画面
- ログイン画面

**使用技術**: Flutter / Dart

### バックエンド（Back-end）

**裏側で動く処理**

```
サーバー
├── データ保存
├── ビジネスロジック
├── 認証・権限チェック
└── 外部サービス連携
```

**TASUKIの例**:
- 動画のアップロード処理
- AI による自動生成
- データベースへの保存
- 権限チェック（Staffは公開マニュアルのみ）

**使用技術**: Supabase / TypeScript

---

## 3. クライアント・サーバーモデル

### 基本的な流れ

```
【フロントエンド（クライアント）】
スマホアプリ
  ↓ リクエスト（要求）
「オーダーの取り方」のマニュアルを見たい
  ↓
【バックエンド（サーバー）】
Supabase
  ↓ 処理
1. ユーザーの権限を確認
2. データベースから検索
3. 結果を整形
  ↓ レスポンス（応答）
マニュアルのデータを返す
  ↓
【フロントエンド】
画面に表示
```

### 専門用語

- **クライアント** = ユーザーが使う側（スマホアプリ）
- **サーバー** = 裏で処理する側（Supabase）
- **リクエスト** = クライアントからサーバーへの要求
- **レスポンス** = サーバーからクライアントへの応答

---

## 4. フロントエンドの詳細（Flutter）

### Flutterの役割

```
Flutter（フロントエンド）
├── UI（ユーザーインターフェース）
│   ├── 画面レイアウト
│   ├── ボタン・入力フォーム
│   └── アニメーション
├── 状態管理（Riverpod）
│   ├── ログイン状態
│   ├── 表示中のマニュアル
│   └── アップロード進行状況
└── ローカルストレージ（Isar）
    ├── オフラインキュー
    └── キャッシュ
```

### 具体例：録画ボタンを押したとき

```dart
// ボタンが押された
onPressed: () {
  // 1. カメラを起動（フロントエンド）
  await camera.startRecording();

  // 2. 録画完了後、動画をアップロード
  await uploadVideo(videoFile);

  // 3. 画面に「アップロード中」表示（フロントエンド）
  showUploadingIndicator();
}
```

**フロントエンドの責務**:
- ユーザーの操作を受け付ける
- わかりやすく表示する
- ローカルで処理できることは処理する（オフライン対応）

---

## 5. バックエンドの詳細（Supabase）

### Supabaseの役割

```
Supabase（バックエンド）
├── データベース（PostgreSQL）
│   ├── データ保存
│   └── RLS（権限管理）
├── 認証（Auth）
│   ├── ログイン
│   └── セッション管理
├── Edge Functions
│   ├── 動画処理
│   ├── AI 呼び出し
│   └── ビジネスロジック
└── Storage
    └── ファイル保存
```

### 具体例：マニュアルを検索したとき

```typescript
// Edge Function: マニュアル検索
async function searchManuals(userId, keyword) {
  // 1. ユーザーの権限を確認（バックエンド）
  const user = await getUser(userId);
  const storeId = user.storeId;

  // 2. データベースから検索（バックエンド）
  const manuals = await supabase
    .from('manuals')
    .select('*')
    .eq('store_id', storeId)  // 自店舗のみ
    .eq('status', 'published')  // 公開済みのみ
    .ilike('ai_summary', `%${keyword}%`);  // キーワード検索

  // 3. 結果を返す
  return manuals;
}
```

**バックエンドの責務**:
- データを安全に保存
- 権限チェック（不正アクセス防止）
- 複雑な処理（AI呼び出し等）
- 複数ユーザー間の調整

---

## 6. なぜ分ける必要があるのか？

### 理由1: セキュリティ

```
❌ 悪い例（フロントエンドだけ）
スマホアプリに全ロジックを書く
  ↓
アプリを解析されたら、全データが見える
  ↓
危険！
```

```
✅ 良い例（バックエンドで保護）
スマホアプリ → サーバーに問い合わせ権限チェック
  ↓
サーバーが「この人は見ていい」と判断
  ↓
データを返す
```

### 理由2: 処理の分担

- **フロントエンド**: 軽い処理（表示・アニメーション）
- **バックエンド**: 重い処理（AI分析・動画変換）

### 理由3: メンテナンス性

```
フロントエンド変更（画面デザイン）
  ↓
バックエンドは変更不要
```

```
バックエンド変更（DB構造）
  ↓
フロントエンドは変更不要（API仕様が同じなら）
```

---

## 7. TASUKIでの実装

### フロントエンド（Flutter）

**ファイル例**:
```
apps/app/lib/
├── features/
│   ├── flow/（Flow機能）
│   │   ├── record_screen.dart（録画画面）
│   │   └── upload_service.dart（アップロード処理）
│   └── stock/（Stock機能）
│       └── timeline_screen.dart（タイムライン）
└── providers/
    └── auth_provider.dart（認証状態管理）
```

### バックエンド（Supabase Edge Functions）

**ファイル例**:
```
apps/edge/supabase/functions/
├── mux_webhook/（Mux Webhook受信）
├── ai_process_handover/（AI処理）
└── import_google_doc/（Google Docs取り込み）
```

---

## 8. 重要な専門用語

| 用語 | 意味 | TASUKIでの例 |
|------|------|-------------|
| **フロントエンド** | ユーザーが見る部分 | Flutterアプリ |
| **バックエンド** | 裏側の処理 | Supabase |
| **クライアント** | ユーザー側 | スマホ |
| **サーバー** | 処理を行う側 | Supabaseサーバー |
| **リクエスト** | 要求 | 「マニュアルを取得して」 |
| **レスポンス** | 応答 | マニュアルのデータ |
| **UI/UX** | 画面・体験 | Flutterで実装 |

---

## 9. ミニクイズ 🎯

### Q1: フロントエンドとバックエンド、それぞれの役割は？
<details>
<summary>答えを見る</summary>

**フロントエンド**: ユーザーが直接触る画面や操作

**バックエンド**: データ保存、権限チェック、重い処理など裏側の処理

</details>

### Q2: なぜフロントエンドとバックエンドを分けるのですか？
<details>
<summary>答えを見る</summary>

**答え**:
1. **セキュリティ**: 重要な処理はサーバー側で行う
2. **処理の分担**: 軽い処理（表示）と重い処理（AI）を分ける
3. **メンテナンス性**: 片方の変更が他方に影響しにくい

</details>

### Q3: TASUKIのバックエンドは何を使っていますか？
<details>
<parameter name="summary">答えを見る</summary>

**答え**: Supabase（BaaS）

PostgreSQLデータベース、認証、Edge Functions、Storageなど、バックエンド機能を一通り提供してくれます。

</details>

---

## 📝 まとめ

- ✅ フロントエンド = ユーザーが見る画面（Flutter）
- ✅ バックエンド = 裏側の処理（Supabase）
- ✅ クライアント・サーバーモデルで通信
- ✅ 役割を分けることでセキュリティ・保守性向上

---

## 🚀 次のステップ

次は「06_APIとは.md」で、フロントエンドとバックエンドがどうやって通信するのかを学びます！

---

## 💡 ブログに書くなら

```markdown
# フロントエンドとバックエンドを学んだ

## レストランに例えると
- フロントエンド = ホール（お客様が見える）
- バックエンド = キッチン（裏で料理を作る）

## TASUKIでは
- フロントエンド: Flutter（スマホアプリ）
- バックエンド: Supabase（サーバー処理）

## なぜ分ける？
セキュリティ、処理分担、メンテナンス性のため
```
