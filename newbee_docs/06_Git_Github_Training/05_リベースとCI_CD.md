# Git/GitHub上級編: 綺麗な履歴とCI/CD 🧹

チーム開発の品質を上げるための「履歴の整理術」と「自動化」について学びます。

## 1. Merge vs Rebase
ブランチを取り込む際、2つの手法があります。

### Merge (マージ)
- **特徴**: 分岐と合流の履歴がそのまま残る。
- **メリット**: 事実をありのままに残すので安全。
- **デメリット**: 「マージコミット」が大量発生し、ログが複雑に入り組んで見にくくなる。

### Rebase (リベース)
- **特徴**: 「私の変更は、最初から最新のmainの後に続いていることにしよう」と歴史を改変する。
- **メリット**: 履歴が一直線になり、非常に見やすい。
- **デメリット**: 履歴を書き換えるため、使い方を間違えると他のメンバーの環境を破壊する（Force Push必須）。

> [!IMPORTANT]
> **「共有ブランチ（mainなど）ではRebase禁止」** が鉄則です。あくまで自分の作業用ブランチを綺麗にするために使います。

## 2. Interactive Rebase (`rebase -i`)
コミットの整理整頓ツールです。
「typo修正」「wip」「fix」のような細かいコミットを、マージ前に一つにまとめる（Squash）ときによく使います。

```bash
# 直近3つのコミットを整理する
git rebase -i HEAD~3
```
エディタが立ち上がり、`pick` を `squash` に書き換えることでコミットを結合できます。

## 3. GitHub Actions (CI/CD)
GitHubに統合された自動化プラットフォームです。
「Pushされたら自動でテストする」「mainにマージされたら自動でデプロイする」などを定義できます。

### 基本構造 (`.github/workflows/test.yaml`)

```yaml
name: Test

on: [push]  # Pushされたら動く

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3  # コードを取得

      - name: Setup Flutter
        uses: subosito/flutter-action@v2

      - name: Run Tests
        run: flutter test
```

### なぜ重要か？
- **品質担保**: 「テストに通らないコードはマージできない」というルール（Branch Protection Rule）と組み合わせることで、壊れたコードが本番に入るのを物理的に防げます。
- **効率化**: リリース作業などの定形業務を自動化し、人間はクリエイティブなことに集中できます。

## 4. コンフリクト解消の極意
コンフリクトは怖いものではありません。
**「相手の変更」と「自分の変更」を論理的に合成するパズル** です。

- 迷ったらチームメンバーと画面共有しながら解消する。
- どうしようもなくなったら `git merge --abort` でマージを中止して元に戻る。

無理やり解消してロジックを壊すのが一番のリスクです。

---

## 📚 用語集 (Glossary)

| 用語 | 意味 | 補足 |
|------|------|-----|
| **Rebase (リベース)** | 歴史改変 | ベース（根元）を付け替える |
| **Squash (スカッシュ)** | 押しつぶす | 複数のコミットを1つにまとめる |
| **CI (Continuous Integration)** | 継続的的インテグレーション | 自動テスト |
| **CD (Continuous Delivery)** | 継続的デリバリー | 自動デプロイ |
| **Force Push (`-f`)** | 強制プッシュ | 歴史を変えた後に使う禁断の技 |
| **GitHub Actions** | 自動化ツール | GitHub公式のCI/CD |

## 🛠️ コマンド集 (Advanced Git)

| コマンド | 説明 |
|---|---|
| `git rebase [branch]` | 指定したブランチの最新を自分のベースにする |
| `git rebase -i HEAD~[n]` | 直近n個のコミットを対話的に編集・結合する |
| `git push -f` | リモートの履歴を強制的に上書きする（要注意） |
| `git merge --abort` | コンフリクト解消を諦めて元に戻す |
