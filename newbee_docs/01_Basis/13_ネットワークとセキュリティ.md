# 13_ネットワークとセキュリティの深層 🌐

HTTPを知っているだけでは解決できないトラブルがあります。
「繋がらない」原因を特定するための、インターネットの地下階層の知識です。

## 1. TCP/IP 4階層モデル
インターネットは4つの層で動いています。

1. **アプリケーション層** (HTTP, DNS, SSH)
   - 私たちが普段触れる層。「Webページ見せて」
2. **トランスポート層** (TCP, UDP)
   - 「データを確実に届ける(TCP)」か「多少こぼしても速く届ける(UDP)」かを決める。
   - **ポート番号** (80, 443) はここで使われる。
3. **インターネット層** (IP)
   - **IPアドレス**を使って、世界中のどこにパケットを届けるか決める（ルーティング）。
4. **ネットワークインターフェース層** (Ethernet, Wi-Fi)
   - 物理的なケーブルや電波で信号を送る。

## 2. TCP vs UDP

### TCP (Transmission Control Protocol)
- **特徴**: 確実性重視。届かなかったら再送する。順番通りに組み立てる。
- **用途**: Web閲覧(HTTP), メール, ファイル転送。
- **3ウェイ・ハンドシェイク**:
  1. 「送っていい？ (SYN)」
  2. 「いいよ！こっちも送っていい？ (SYN/ACK)」
  3. 「OK！ (ACK)」
  この儀式をしてから通信を始めるので、信頼性は高いが少し遅い。

### UDP (User Datagram Protocol)
- **特徴**: スピード重視。投げっぱなし。パケットが消えても気にしない。
- **用途**: リアルタイム動画配信、オンラインゲーム、DNS。
- 動画がたまにブロックノイズになるのは、UDPパケットが一部落ちているからです。でも止まるよりマシなのでUDPを使います。

## 3. DNS (Domain Name System)
インターネットの電話帳です。
`google.com` (人間用) を `142.250.xxx.xxx` (コンピュータ用) に変換します。

- 「ブラウザでURL叩いても繋がらないけど、IP直打ちなら繋がる」
  - → DNSサーバーが死んでいるか、設定が間違っている可能性大。

## 4. SSL/TLS と HTTPS
通信を許可なく覗き見されないための暗号化技術です。

### SSLハンドシェイクの流れ
1. **Client Hello**: 「この暗号方式で話しましょう」
2. **Server Hello**: 「OK。これが私の証明書です」
3. **検証**: クライアントは証明書が本物か（認証局の署名があるか）確認する。
4. **鍵交換**: 共通鍵（セッションキー）を安全に共有する。
5. **暗号化通信開始**: 以降は共通鍵で暗号化して話す。

### 証明書エラー
- 「この接続はプライバシーが保護されていません」
- 原因:
  - **期限切れ**: 証明書の有効期限が過ぎている。
  - **オレオレ証明書**: 誰の承認も得ていない自作の証明書（開発環境ではよくある）。
  - **ドメイン不一致**: `example.com` 用の証明書なのに `test.com` で使っている。

---

## 📚 用語集 (Glossary)

| 用語 | 意味 | 例 |
|------|------|-----|
| **IPアドレス** | インターネット上の住所 | `192.168.1.1` |
| **Port (ポート)** | どの部屋（アプリ）に届けるかの番号 | `80`(Web), `443`(SSL), `5432`(PostgreSQL) |
| **DNS** | 住所解決サービス（電話帳） | `google.com` → IP |
| **TCP** | 確実さ優先の通信 | HTTP, メール |
| **UDP** | 速さ優先の通信 | 動画, ゲーム |
| **SSL/TLS** | 通信の暗号化技術 | HTTPSのSはこれ |
| **Packet (パケット)** | データの小包。分割して送られる | - |

## 🛠️ コマンド集 (Network Tools)

| コマンド | 説明 |
|---|---|
| `ping <url>` | 相手と繋がるか確認する（生存確認） |
| `curl <url>` | HTTPリクエストを送ってみる |
| `nslookup <domain>` | ドメインからIPを調べる（DNS確認） |
| `traceroute <url>` | どの経路を通っているか調べる |
