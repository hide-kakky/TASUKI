# 03_Process Companion（チェックリストと回答例）

開発フロー・レビュー・テスト・運用を素早く実践するための補助資料です。

## 01_実装の流れ
- チェック: 設計→実装→テスト→デプロイの順で進んでいるか。
- 例: 「DB変更→Edge Functions→Flutter UI」の順でPRを分ける。
- 進捗欄: [ ] 設計メモ [ ] 実装PR [ ] テスト完了 [ ] デプロイ手順共有
- テスト観点（簡易）: 正常系/例外系/境界値/権限/非同期・遅延/ログ

## 02_テストと環境分離
- チェック: ローカル/ステージング/本番の差分（DB/キー/エンドポイント）を把握。
- 例: ステージング用の環境変数ファイルと本番を明示的に分ける。
- 簡易表: 環境 / ドメイン / 認証設定 / データ初期化手順
- テスト観点テンプレ:
```
- [ ] Lint/静的解析
- [ ] Unit: 関数ロジック・境界値
- [ ] UI: 画面遷移・フォーム入力
- [ ] E2E: 主要ユーザーフロー
- [ ] パフォーマンス/レイテンシ（必要に応じて）
```

## 03_コードレビューの歩き方
- 観点: 正しさ/安全性/読みやすさ/テスト有無。
- コメント例: 「この関数は副作用がありますか？もしあれば docstring に追記できると嬉しいです。」
- PRテンプレ例:
```
## 概要
## 変更ポイント
## テスト
- [ ] Lint
- [ ] Unit
- [ ] UI/E2E
## リスク/確認事項
```

## 04_良いIssueの書き方
- テンプレ: タイトル/概要/再現手順/期待結果/スクショ/環境情報。
- 例: 「再現: iOS 17.4, ログイン後に動画再生でクラッシュ」など。
- バグ切り分けメモ例:
```
事象: 再生ボタンでクラッシュ
再現: iOS17.4, 動画A, ログイン済み
期待: 再生開始
実際: アプリ落ちる (ログにnull dereference)
仮説: Mux再生URLがnull
検証: Edge Functionsレスポンスをローカルでモック→UIのみ動作確認
```

## 05_デバッグの基本
- フレーム: 事象→再現条件→期待と実際→仮説→検証計画。
- 例: 「Edge Functionsのレスポンスをローカルで差し替えてUIのみ確認する」。
- 切り分けチェックリスト:
- [ ] 再現性の有無（毎回/一部環境のみ）
- [ ] 入力データの差し替え（モック/フェイク）
- [ ] ネットワーク依存を外せるか（ローカルスタブ）
- [ ] ログ/メトリクスに痕跡があるか
- [ ] 最近の変更と影響範囲

## 06_テスト戦略完全ガイド
- 役割: Unit=最小ロジック、UI=画面挙動、E2E=実運用近似。
- 例: 失敗時のエラーメッセージをUIテストで検証する。
- テスト観点チェックリスト:
```
- 正常/異常/境界値
- 認証/認可/RLS
- 非同期処理・再試行・タイムアウト
- パフォーマンス（キャッシュ/ネットワーク）
- ログ/トレーシングが残るか
```

## 07_アーキテクチャと依存注入
- ポイント: インターフェース越しに依存を渡し、モックしやすくする。
- 例: リポジトリを抽象化し、テストでフェイク実装を差し込む。

## 08_CI_CDパイプライン構築
- ステージ例: Lint → Unit → UI/E2E → Build → Deploy。
- 例: mainブランチはデプロイまで、PRブランチはLint+Unitまでを必須にする。
- サンプルパイプライン（擬似）:
```
jobs:
  lint:
  unit:
    needs: lint
  ui:
    needs: unit
  deploy:
    needs: [unit, ui]
    if: branch == "main"
```
- 観点チェック: フレークテスト隔離 / キャッシュ利用 / 並列化 / 秘密情報の扱い / デプロイの手動承認可否

## 09_SREと可観測性
- ポイント: SLI/SLO/エラーバジェットで運用判断。
- 例: 動画再生成功率99%をSLOに設定し、ダッシュボードで監視する。
- SLOテンプレ:
```
サービス: 動画再生
SLI: 成功再生率 (成功再生数 / 全再生試行)
SLO: 99% / 30日
エラーバジェット: 1%
```
- 追加テンプレ（遅延系）:
```
サービス: APIレスポンス
SLI: p95 レイテンシ (ms)
SLO: 500ms 以下を95% / 7日
エラーバジェット: 5%
```
