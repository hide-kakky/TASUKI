# BATON デリバリープラン（自律更新版）

本ドキュメントは AI エージェント自身が管理する実行計画書です。作業が一段階進むたびに必ず本書を上書きし、進捗と次アクションを宣言してください。

---

## 0. 運用ルール（AI 自律更新）
1. **参照チェック**：更新前に `docs/BATON_requirements_v8.5.*` / `docs/BATON_implementation_guide_v1.0.*` を再読し、引用すべき要件を記載する。
2. **更新タイミング**：タスク完了 / 検証完了 / コスト評価 / 仕様判断の直後に必ず上書き。
3. **記法**：
   - ✅ 完了、▶ 着手中、□ 未着手
   - `NOTE:` 情報、`RISK:` リスク、`ACTION:` 次に自動実行すること
4. **自走宣言**：各更新の末尾で「次に着手するタスク」「想定完了時刻」「必要な入力」を宣言し、承認不要な範囲は自動で進める。

---

## 1. ミッション整合
- **参照要件**：`docs/BATON_requirements_v8.6.md`
- **デザイン図面**：`docs/BATON_design_diagrams.md` (Flows, Sequences, ERD)
- **DBスキーマ**：`docs/BATON_database_schema.md` (Tables, RLS)
- **API定義**：`docs/BATON_api_definition.md` (Edge Functions, Webhooks)
- **インフラ**：`docs/BATON_infra_setup.md` (Supabase, Mux, Gemini)
- **テスト計画**：`docs/BATON_testing_plan.md` (QA Strategy)
- **ユーザー価値**：Flow→Stock を 7 日以内に体験させ、教育コスト削減を実感させる。

---

## 2. 現状スナップショット
- **フェーズ**：`<Phase1 / Phase2 / Phase3>`
- **期間**：`<Day X–Y>`
- **主要担当**：`Codex`
- **最新決定 / アクション**：
  - `NOTE: ...`
- **ブロッカー / 依存**：
  - `RISK: ...`

※ 作業が進んだら内容を書き換える。

---

## 3. マイルストーンボード
| # | マイルストーン | ステータス | Exit 条件 / 実績 | 目標日 | オーナー | 次アクション |
|---|----------------|-----------|------------------|--------|----------|--------------|
| 1 | Flow→Mux→Stock Draft | □ | Edge / Gemini 連携で draft 保存 + Google Docs 取り込み | YYYY-MM-DD | Codex | `<ACTION: ...>` |
| 2 | Manager 承認 & 一般閲覧 | □ | Draft 承認→公開、一般閲覧 UI | YYYY-MM-DD | Codex |  |
| 3 | L0→L1 抽象化 & コスト監視 | □ | Video/Ai Service 抽出 + Cron | YYYY-MM-DD | Codex |  |

**運用**：更新時にステータスを ✅/▶/□ へ変更し、Exit 条件には実績と検証結果を追記する。`次アクション` には完了までの手順を記載。

---

## 4. 作業分解 & 進行ログ
### 4.1 タスク一覧
- **インフラ / SaaS**
  - □ Supabase スキーマ検証
  - □ Mux Webhook 設定
  - □ Gemini API Key 配布
- **データ / セキュリティ**
  - □ RLS ポリシー草案
  - □ RBAC テスト
- **バックエンド**
  - □ `mux_webhook` 実装
  - □ `ai_process_handover` 実装
  - □ `import_google_doc` 実装
- **フロントエンド**
  - □ Flow 録画 UI
  - □ Offline Queue
  - □ Manager 承認 UI & Google Docs 追加モーダル
  - □ 一般ユーザー閲覧 UI（タイムライン/一覧/詳細）

### 4.2 進行ログ
| 日付 | タスク | ステータス | 検証 / 備考 |
|------|--------|------------|-------------|
| YYYY-MM-DD | `<タスク名>` | ✅/▶/□ | `NOTE: 手動テスト結果やブランチ名など` |

---

## 5. リスク & 対応
| リスク | 影響 | 状態 | 対応策 / 教訓 |
|--------|------|------|----------------|
| RLS 設計ミス | データ漏洩 | ▢ Open | `plan: owner-only→段階緩和` |
| AI 成果ムラ | 承認遅延 | ▢ Open | `manual_edits ログでプロンプト調整` |

解消済みなら `✅ Closed` と明記し、備考に学びを残す。

---

## 6. 指標 / 検証ログ
- **ビルド検証**：`<実行したテスト / 結果>`
- **Activation 指標**：`Flow 投稿数, Flow→Stock 成功率, Manager 承認率 等`
- **コスト監視**：`Mux/Gemini 推定コストと ARPU 比`

新しい検証を実施したら必ずここに記録し、次回アクションに反映する。

---

## 7. コミュニケーション / 次アクション
- **最新アップデート**：`<いつ・何を報告したか>`
- **次に着手するタスク**：`<ACTION: AI 自身が宣言（想定完了時刻付き）>`
- **必要な支援**：`<ユーザー確認事項があれば列挙>`

このセクションにより、AI エージェントが次工程へ自発的に進むことを保証する。

---

### 更新例（参考）
> 2025-01-05 更新：Flow 録画 UI を実装し、オフラインキューを導入。現在 Phase2 Day6。次は `mux_webhook` と `ai_process_handover` を実装し、完了後にマイルストーン 1 を ✅ に更新する。

---

**重要**：このファイルは常に最新の進捗と次アクションを表す「単一の真実源」です。AI エージェントは作業完了のたびに本書を更新し、ユーザーが不在でも計画を前進させてください。
